parameters:
  project: ''
  vmImage: ''
  name: ''

jobs:
  - job: ${{ parameters.name }}_build
    displayName: ${{ parameters.name }}

    pool:
      vmImage: ${{ parameters.vmImage }}

    steps:
      - script: cd ${{ parameters.project }} && ls && python ci.env.py && echo env.AGORA_APP_ID
        env:
          AGORA_APP_ID: $(agora.appId)

      - task: Gradle@2
        inputs:
          workingDirectory: '${{ parameters.project }}'
          gradleWrapperFile: '${{ parameters.project }}/gradlew'
          gradleOptions: '-Xmx3072m'
          publishJUnitResults: false
          testResultsFiles: '**/TEST-*.xml'
          tasks: 'assembleDebug'

      - task: CopyFiles@2
        inputs:
          Contents: '**/*.apk'
          TargetFolder: '$(Build.ArtifactStagingDirectory)'

      - task: PublishBuildArtifacts@1
        inputs:
          PathtoPublish: '$(Build.ArtifactStagingDirectory)'
          ArtifactName: ${{ parameters.project }}